//
// backbone.stickit v0.5.2
//
// The MIT License
// Copyright (c) 2012 The New York Times, CMS Group, Matthew DeLambo <delambo@gmail.com>
//
(function(q){var p,o,m,r;_.extend(Backbone.View.prototype,{_modelBindings:null,unstickModel:function(){_.each(this._modelBindings,function(b){b.model.off(b.event,b.fn)});this._modelBindings=[]},stickit:function(b,a){var c=this,g,d=b||this.model,i=a||this.bindings||{};this._modelBindings||(this._modelBindings=[]);this.events||(this.events={});g=function(a,b){d.on(a,b,c);c._modelBindings.push({model:d,event:a,fn:b})};_.each(_.keys(i),function(a){var b,j,n,h,e=i[a]||{},l=_.uniqueId(),k=c.$(a);if(!k.length)return!1;
typeof e==="string"&&(e={modelAttr:e});n=e.format;h=e.modelAttr;j=e.attributes||[];b=function(a){a=e.escape?d.escape(a):d.get(a);_.isUndefined(a)&&(a="");return n?o(c,n,a,h):a};_.each(j,function(a){var b="",e=a.observe||h,f=function(){var f;f=a.format?o(c,a.format,d.get(e),e):d.get(e);a.name=="class"?(k.removeClass(b).addClass(f),b=f):k.attr(a.name,f)};g("bind:"+e,f);f()});if(h){j=function(){var a=_.extend({bindKey:l},e.setOptions||{});d.set(h,r(k),a)};if(k.is("input[type=radio]")||k.is("input[type=checkbox]")||
k.is("select"))c.events["change "+a]=j;else if(k.is("input")||k.is("textarea"))c.events["keyup "+a]=j,c.events["change "+a]=j;g("bind:"+h,function(a,f){f&&f.bindKey!=l&&m(c,k,e,b(h),d)});m(c,k,e,b(h),d,!0)}});this.delegateEvents();this.remove=_.wrap(this.remove,function(a){c.unstickModel();a&&a.call(c)})}});Backbone.Model.prototype.set=_.wrap(Backbone.Model.prototype.set,function(b,a,c,g){var d,i=g&&_.clone(g)||{},f=this.attributes;_.isObject(a)||a==null?(d=a,i=c):(d={},d[a]=c);i||(i={});b=b.call(this,
d,i);_.each(_.keys(d),_.bind(function(a){(!_.isEqual(f[a],void 0)||i.unset&&_.has(f,a))&&this.trigger("bind:"+a,d[a],i)},this));return b});p=function(b,a){var c=(a||"").split(".");return _.reduce(c,function(a,b){return a[b]},b)||b};o=function(b,a){if(a)return(_.isString(a)?b[a]:a).apply(b,_.toArray(arguments).slice(2))};r=function(b){return b.is("input[type=checkbox]")?b.prop("checked"):b.is("select")?b.find("option:selected").data("stickit_bind_val"):b.is("input[type=number]")?Number(b.val()):b.val()};
m=function(b,a,c,g,d,i){var f,m=c.modelAttr,j=c.readonly,n=c.afterUpdate,h=c.selectOptions,e=c.updateMethod||"text",c=function(){j?_.isBoolean(j)?a.prop("readonly",j):a.prop("readonly",b[j].call(b,m)):a.prop("readonly",!1)};if(a.is("input[type=radio]"))d=a.filter("[value="+g+"]"),f=d.prop("checked"),d.prop("checked",!0),c();else if(a.is("input[type=checkbox]"))f=a.prop("checked"),a.prop("checked",g===!0),c();else if(a.is("input")||a.is("textarea"))f=a.val(),f!=g&&a.val(g),c();else if(a.is("select")){var e=
h.collection,l=d.get(m);a[0].options.length&&a[0].selectedIndex>=0&&(f=q(a[0].options[a[0].selectedIndex]).data("stickit_bind_val"));a.html("");d=_.isFunction(e)?e.call(b):p(window,e);l==null&&a.append("<option/>").find("option").prop("selected",!0).data("stickit_bind_val",l);_.each(d,function(b){var c=q("<option/>"),d=b;b!=null&&(c.text(b[h.labelPath]),d=p(b,h.valuePath));c.data("stickit_bind_val",d);(d!=null&&l!=null&&d==l||_.isObject(l)&&_.isEqual(d,l))&&c.prop("selected",!0);a.append(c)});c()}else f=
a[e](),a[e](g);i||o(b,n,a,g,f)}})(window.jQuery||window.Zepto);
